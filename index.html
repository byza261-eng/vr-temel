<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>HaritaG√∂z - AR Harita Okuryazarlƒ±ƒüƒ± Sim√ºlat√∂r√º (VR + Katmanlar)</title>

  <!-- Leaflet (Ger√ßek harita) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
      background:linear-gradient(135deg,#1a2a3a 0%,#2d4a5c 100%);
      color:#fff;
      overflow-x:hidden;
      -webkit-text-size-adjust:100%;
    }

    .header{
      background:rgba(0,0,0,.3);
      padding:20px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      backdrop-filter:blur(10px);
      border-bottom:2px solid rgba(76,175,80,.3);
      gap:12px;
      position:sticky;top:0;z-index:50;
    }
    .logo{font-size:28px;font-weight:bold;color:#4CAF50;display:flex;align-items:center;gap:10px}

    .stats{display:flex;gap:14px;align-items:center;flex-wrap:wrap;justify-content:flex-end}
    .stat-item{text-align:center;min-width:74px}
    .stat-value{font-size:22px;font-weight:bold;color:#FFC107}
    .stat-label{font-size:12px;color:#B0BEC5}

    .bep-toggle,.vr-toggle{
      color:white;border:none;padding:10px 14px;border-radius:20px;
      cursor:pointer;font-size:14px;transition:.25s;white-space:nowrap;
      -webkit-tap-highlight-color:transparent;touch-action:manipulation;
    }
    .bep-toggle{background:#2196F3}
    .bep-toggle:hover{background:#1976D2;transform:scale(1.03)}
    .bep-toggle.active{background:#FF9800}

    .vr-toggle{background:linear-gradient(135deg,#4CAF50,#8BC34A)}
    .vr-toggle:hover{transform:scale(1.03)}
    .vr-toggle.active{background:linear-gradient(135deg,#f44336,#ff5252)}

    .container{max-width:1400px;margin:0 auto;padding:30px 20px}
    .section{
      background:rgba(255,255,255,.05);
      border-radius:20px;
      padding:30px;
      margin-bottom:30px;
      backdrop-filter:blur(10px);
      border:1px solid rgba(255,255,255,.1);
    }
    .section-title{font-size:28px;margin-bottom:20px;color:#4CAF50;display:flex;align-items:center;gap:10px}

    .ar-simulator{
      background:#1a1a1a;border-radius:15px;padding:20px;position:relative;
      min-height:500px;border:3px solid #4CAF50;overflow:hidden;
    }

    /* Harita alanƒ±: eski ar-viewport yerine ger√ßek harita */
    .ar-viewport{
      position:relative;width:100%;height:450px;
      background:#0b1218;border-radius:10px;overflow:hidden;
    }
    #mapNormal{width:100%;height:100%}

    /* Info points √ºstte (dokunulabilir) */
    .ar-info-point{
      position:absolute;z-index:10;
      background:rgba(76,175,80,.92);color:#fff;
      padding:10px 15px;border-radius:10px;font-size:14px;
      box-shadow:0 4px 10px rgba(0,0,0,.3);
      animation:pulse 2s infinite;
      cursor:pointer;transition:transform .3s;
      -webkit-tap-highlight-color:transparent;
      touch-action:manipulation;
      user-select:none;
    }
    .ar-info-point:hover{transform:scale(1.08)}
    @keyframes pulse{0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}

    .layer-controls{display:flex;flex-wrap:wrap;gap:10px;margin-top:20px}

    .layer-btn{
      padding:12px 20px;border:none;border-radius:10px;cursor:pointer;
      font-size:14px;font-weight:600;transition:all .3s;
      display:flex;align-items:center;gap:8px;
      -webkit-tap-highlight-color:transparent;
      touch-action:manipulation;
      user-select:none;
    }
    .layer-btn:hover{transform:translateY(-3px);box-shadow:0 6px 20px rgba(0,0,0,.3)}
    .layer-btn.inactive{opacity:.45;filter:grayscale(100%)}

    .layer-btn.topography{background:linear-gradient(135deg,#8B4513,#D2691E);color:#fff}
    .layer-btn.roads{background:linear-gradient(135deg,#FFD700,#FFA500);color:#333}
    .layer-btn.water{background:linear-gradient(135deg,#1E90FF,#4169E1);color:#fff}
    .layer-btn.settlement{background:linear-gradient(135deg,#FF6347,#FF8C00);color:#fff}
    .layer-btn.risk{background:linear-gradient(135deg,#DC143C,#8B0000);color:#fff}

    .direction-controls{
      display:grid;grid-template-columns:repeat(3,1fr);
      gap:10px;max-width:200px;margin:20px auto;
    }
    .direction-btn{
      padding:15px;background:#2196F3;border:none;border-radius:10px;color:#fff;
      cursor:pointer;font-size:18px;transition:.3s;
      -webkit-tap-highlight-color:transparent;
      touch-action:manipulation;
      user-select:none;
    }
    .direction-btn:hover{background:#1976D2;transform:scale(1.06)}
    .direction-btn:nth-child(2){grid-column:2}
    .direction-btn:nth-child(4){grid-column:1}
    .direction-btn:nth-child(5){grid-column:3}
    .direction-btn:nth-child(6){grid-column:2}

    .missions{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-top:20px}
    .mission-card{
      background:linear-gradient(135deg,rgba(33,150,243,.2),rgba(76,175,80,.2));
      padding:20px;border-radius:15px;border:2px solid rgba(255,255,255,.2);
      cursor:pointer;transition:.3s;position:relative;
    }
    .mission-card:hover{transform:translateY(-5px);border-color:#4CAF50;box-shadow:0 10px 30px rgba(76,175,80,.3)}
    .mission-card.completed{border-color:#4CAF50;background:linear-gradient(135deg,rgba(76,175,80,.3),rgba(139,195,74,.3))}
    .mission-card.active{border-color:#FFC107;animation:glow 2s infinite}
    @keyframes glow{0%,100%{box-shadow:0 0 20px rgba(255,193,7,.5)}50%{box-shadow:0 0 40px rgba(255,193,7,.8)}}

    .mission-title{font-size:18px;font-weight:bold;margin-bottom:10px;color:#4CAF50}
    .mission-desc{font-size:14px;color:#CFD8DC;margin-bottom:15px}
    .mission-reward{font-size:16px;color:#FFC107;font-weight:bold}
    .mission-status{
      position:absolute;top:10px;right:10px;width:30px;height:30px;border-radius:50%;
      display:flex;align-items:center;justify-content:center;font-size:18px
    }
    .mission-status.locked{background:#757575}
    .mission-status.active{background:#FFC107}
    .mission-status.completed{background:#4CAF50}

    .achievements{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:20px;margin-top:20px}
    .achievement{
      background:rgba(255,255,255,.05);padding:20px;border-radius:15px;text-align:center;
      border:2px solid rgba(255,255,255,.1);transition:.3s
    }
    .achievement.unlocked{border-color:#FFC107;background:rgba(255,193,7,.1)}
    .achievement-icon{font-size:48px;margin-bottom:10px;filter:grayscale(100%)}
    .achievement.unlocked .achievement-icon{filter:grayscale(0%);animation:bounce .6s}
    @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)}}
    .achievement-name{font-size:14px;font-weight:bold;margin-bottom:5px}
    .achievement-desc{font-size:11px;color:#B0BEC5}

    .quiz{margin-top:20px}
    .quiz-question{background:rgba(255,255,255,.05);padding:20px;border-radius:15px;margin-bottom:15px}
    .quiz-question-text{font-size:16px;margin-bottom:15px;color:#E0E0E0}
    .quiz-options{display:flex;flex-direction:column;gap:10px}
    .quiz-option{
      padding:15px;background:rgba(255,255,255,.1);border:2px solid transparent;border-radius:10px;
      cursor:pointer;transition:.3s;
      -webkit-tap-highlight-color:transparent;
      touch-action:manipulation;
      user-select:none;
    }
    .quiz-option:hover{background:rgba(255,255,255,.15);border-color:#2196F3}
    .quiz-option.selected{border-color:#FFC107;background:rgba(255,193,7,.2)}
    .quiz-option.correct{border-color:#4CAF50;background:rgba(76,175,80,.2)}
    .quiz-option.wrong{border-color:#F44336;background:rgba(244,67,54,.2)}

    .btn-primary{
      background:linear-gradient(135deg,#4CAF50,#8BC34A);
      color:white;border:none;padding:15px 30px;border-radius:25px;
      font-size:16px;font-weight:bold;cursor:pointer;transition:.3s;display:inline-block;margin-top:20px;
      -webkit-tap-highlight-color:transparent;
      touch-action:manipulation;
    }
    .btn-primary:hover{transform:translateY(-3px);box-shadow:0 10px 25px rgba(76,175,80,.4)}
    .btn-primary:disabled{opacity:.5;cursor:not-allowed}

    .result-panel{
      background:linear-gradient(135deg,rgba(76,175,80,.2),rgba(33,150,243,.2));
      padding:30px;border-radius:15px;text-align:center;margin-top:20px;border:2px solid #4CAF50;
    }
    .result-score{font-size:48px;font-weight:bold;color:#FFC107;margin-bottom:10px}
    .result-message{font-size:20px;color:#E0E0E0;margin-bottom:20px}

    /* BEP Mode */
    body.bep-mode{font-size:18px}
    body.bep-mode .section-title{font-size:36px}
    body.bep-mode .layer-btn,body.bep-mode .direction-btn,body.bep-mode .quiz-option{font-size:18px;padding:20px}
    body.bep-mode .mission-card{padding:30px}
    body.bep-mode .btn-primary{font-size:20px;padding:20px 40px}

    .hidden{display:none}

    .task-prompt{
      background:rgba(255,193,7,.2);
      border:2px solid #FFC107;
      padding:20px;border-radius:15px;margin-bottom:20px;
    }
    .task-prompt-title{font-size:20px;font-weight:bold;color:#FFC107;margin-bottom:10px}
    .task-prompt-desc{font-size:16px;color:#E0E0E0}

    @media (max-width:768px){
      .stats{flex-direction:column;gap:10px;align-items:flex-end}
      .missions{grid-template-columns:1fr}
      .achievements{grid-template-columns:repeat(2,1fr)}
    }

    /* ===== VR OVERLAY ===== */
    body.vr-lock{
      overflow:hidden;
      position:fixed;
      inset:0;
      width:100%;
      height:100%;
      touch-action:none;
    }
    #vrOverlay{
      position:fixed;inset:0;z-index:9999;
      background:#000;
      display:none;
    }
    #vrOverlay.on{display:block}

    .vr-stage{position:absolute;inset:0;display:flex;width:100%;height:100%}
    .eye{position:relative;width:50%;height:100%;overflow:hidden;background:#000}
    .eye .map{position:absolute;inset:0;width:100%;height:100%}
    #mapLeft,#mapRight{width:100%;height:100%}

    /* HUD: sabit, g√∂r√ºn√ºr ve tƒ±klanabilir */
    .vr-hud{
      position:absolute;
      top: env(safe-area-inset-top, 10px);
      left:0;right:0;
      display:flex;gap:10px;flex-wrap:wrap;
      justify-content:center;
      padding:10px;
      z-index:200;
      pointer-events:auto;
    }
    .vr-hud *{pointer-events:auto}

    .vr-bottom{
      position:absolute;
      bottom: calc(env(safe-area-inset-bottom, 0px) + 10px);
      left:0;right:0;
      display:flex;gap:10px;flex-wrap:wrap;
      justify-content:center;
      padding:0 10px;
      z-index:200;
      pointer-events:auto;
    }
    .vr-chip{
      background:rgba(0,0,0,.45);
      border:1px solid rgba(255,255,255,.18);
      padding:10px 12px;border-radius:14px;
      font-weight:700;font-size:13px;color:#fff;
    }
    .vr-btn{
      border:none;border-radius:14px;padding:12px 14px;
      font-weight:900;cursor:pointer;
      background:rgba(255,255,255,.1);
      border:1px solid rgba(255,255,255,.14);
      color:#fff;
      -webkit-tap-highlight-color:transparent;
      touch-action:manipulation;
      user-select:none;
    }
    .vr-btn:active{transform:scale(.98)}
    .vr-btn.danger{background:linear-gradient(135deg,#f44336,#ff5252);border:none}
    .vr-btn.good{background:linear-gradient(135deg,#4CAF50,#8BC34A);border:none}
    .vr-btn.warn{background:linear-gradient(135deg,#ff9800,#ffb300);border:none;color:#222}

    .compass{
      position:absolute;
      right:12px;
      top: calc(env(safe-area-inset-top, 10px) + 12px);
      z-index:220;
      background:rgba(0,0,0,.45);
      border:1px solid rgba(255,255,255,.18);
      padding:10px 12px;border-radius:14px;
      min-width:110px;text-align:center;
      pointer-events:none;
    }
    .compass .dir{font-weight:900;color:#fff;font-size:14px}
    .compass .deg{font-size:12px;color:rgba(255,255,255,.8)}

    #rotateHint{
      display:none;
      position:absolute;inset:0;z-index:300;
      background:rgba(0,0,0,.85);
      align-items:center;justify-content:center;
      padding:20px;text-align:center;
      font-weight:900;font-size:18px;
    }
    #rotateHint.on{display:flex}

    /* Leaflet attribution k√º√ß√ºk */
    .leaflet-control-attribution{font-size:10px}
  </style>
</head>

<body>
  <div class="header">
    <div class="logo">üó∫Ô∏è HaritaG√∂z</div>
    <div class="stats">
      <div class="stat-item">
        <div class="stat-value" id="score">0</div>
        <div class="stat-label">Puan</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="level">1</div>
        <div class="stat-label">Seviye</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="missions-completed">0/8</div>
        <div class="stat-label">G√∂rev</div>
      </div>
      <button class="bep-toggle" id="bep-toggle">BEP Modu</button>
      <button class="vr-toggle" id="vr-toggle">ü•Ω VR Modu</button>
    </div>
  </div>

  <div class="container">
    <!-- AR Simulator Section -->
    <div class="section">
      <div class="section-title">üéØ AR Harita Sim√ºlat√∂r√º</div>

      <div class="task-prompt" id="current-task">
        <div class="task-prompt-title">Ho≈ü Geldiniz!</div>
        <div class="task-prompt-desc">
          Topografya (y√ºkselti) her zaman a√ßƒ±k. Diƒüer katmanlarƒ± butonlarla a√ß/kapat yapƒ±n.
          Y√∂n butonlarƒ±yla haritada hareket edin. Bilgi noktalarƒ±na dokunarak puan kazanƒ±n.
        </div>
      </div>

      <div class="ar-simulator">
        <div class="ar-viewport" id="ar-viewport">
          <!-- Ger√ßek Harita -->
          <div id="mapNormal"></div>

          <!-- AR Info Points (UI √ºstte, haritanƒ±n √ºst√ºne) -->
          <div class="ar-info-point" style="top: 12%; left: 10%;" data-info="topography">üìä Topografya</div>
          <div class="ar-info-point" style="top: 70%; left: 60%;" data-info="risk">‚ö†Ô∏è Risk B√∂lgesi</div>
          <div class="ar-info-point" style="top: 40%; left: 70%;" data-info="water">üíß Su Kaynaƒüƒ±</div>
        </div>

        <div class="layer-controls">
          <!-- Topo: hep a√ßƒ±k, g√∂rsel olarak "aktif" -->
          <button class="layer-btn topography" data-layer="topography">üèîÔ∏è Topografya (Hep A√ßƒ±k)</button>
          <button class="layer-btn roads inactive" data-layer="roads">üõ£Ô∏è Ula≈üƒ±m Aƒülarƒ±</button>
          <button class="layer-btn water inactive" data-layer="water">üíß Su Kaynaklarƒ±</button>
          <button class="layer-btn settlement inactive" data-layer="settlement">üèòÔ∏è Yerle≈üim</button>
          <button class="layer-btn risk inactive" data-layer="risk">‚ö†Ô∏è Risk B√∂lgeleri</button>
        </div>

        <div class="direction-controls">
          <button class="direction-btn" data-direction="nw">‚ÜñÔ∏è</button>
          <button class="direction-btn" data-direction="n">‚¨ÜÔ∏è</button>
          <button class="direction-btn" data-direction="ne">‚ÜóÔ∏è</button>
          <button class="direction-btn" data-direction="w">‚¨ÖÔ∏è</button>
          <button class="direction-btn" data-direction="e">‚û°Ô∏è</button>
          <button class="direction-btn" data-direction="sw">‚ÜôÔ∏è</button>
          <button class="direction-btn" data-direction="s">‚¨áÔ∏è</button>
          <button class="direction-btn" data-direction="se">‚ÜòÔ∏è</button>
        </div>
      </div>
    </div>

    <!-- Missions Section -->
    <div class="section">
      <div class="section-title">üéØ G√∂revler</div>
      <div class="missions" id="missions"></div>
    </div>

    <!-- Achievements Section -->
    <div class="section">
      <div class="section-title">üèÜ Ba≈üarƒ±mlar</div>
      <div class="achievements" id="achievements"></div>
    </div>

    <!-- Quiz Section -->
    <div class="section" id="quiz-section">
      <div class="section-title">üìù Harita Okuryazarlƒ±ƒüƒ± Testi</div>
      <div class="quiz" id="quiz"></div>
      <button class="btn-primary" id="check-answers">Cevaplarƒ± Kontrol Et</button>
      <div class="result-panel hidden" id="quiz-result">
        <div class="result-score" id="quiz-score"></div>
        <div class="result-message" id="quiz-message"></div>
      </div>
    </div>
  </div>

  <!-- VR Overlay -->
  <div id="vrOverlay" aria-hidden="true">
    <div id="rotateHint">üì± VR i√ßin telefonu <u>yatay</u> √ßevir</div>

    <div class="vr-stage">
      <div class="eye"><div class="map" id="mapLeft"></div></div>
      <div class="eye"><div class="map" id="mapRight"></div></div>

      <div class="vr-hud" id="vrHud">
        <button class="layer-btn topography" data-layer="topography" title="Topo hep a√ßƒ±k">üèîÔ∏è</button>
        <button class="layer-btn roads inactive" data-layer="roads">üõ£Ô∏è</button>
        <button class="layer-btn water inactive" data-layer="water">üíß</button>
        <button class="layer-btn settlement inactive" data-layer="settlement">üèòÔ∏è</button>
        <button class="layer-btn risk inactive" data-layer="risk">‚ö†Ô∏è</button>

        <button class="vr-btn warn" id="motionBtn">üéõ Ba≈ü ƒ∞zleme ƒ∞zni</button>
        <button class="vr-btn danger" id="vrCloseBtn">‚úñ VR Kapat</button>
      </div>

      <div class="compass">
        <div class="dir" id="compassDir">N</div>
        <div class="deg" id="compassDeg">0¬∞</div>
      </div>

      <div class="vr-bottom">
        <span class="vr-chip">Y√∂n: Ok tu≈ülarƒ± / D-Pad</span>
        <button class="vr-btn" id="zoomOut">‚ûñ Zoom</button>
        <button class="vr-btn" id="zoomIn">‚ûï Zoom</button>
        <button class="vr-btn good" id="centerTR">üáπüá∑ Ortala</button>
        <span class="vr-chip">Se√ß/Tog: Enter / Space</span>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    /***********************
     * iOS dokunma fix helper
     ***********************/
    function bindTap(el, fn){
      const handler = (e)=>{ e.preventDefault(); fn(e); };
      el.addEventListener("pointerdown", handler, {passive:false});
      el.addEventListener("touchstart", handler, {passive:false});
      el.addEventListener("click", handler, {passive:false});
    }

    /***********************
     * Game State (senin yapƒ±n korundu)
     ***********************/
    const gameState = {
      score: 0,
      level: 1,
      completedMissions: 0,
      activeLayers: ['topography'],   // topo hep a√ßƒ±k
      currentDirection: 'n',
      achievements: [],
      bepMode: false,

      // ek: y√∂nleri benzersiz sayacaƒüƒ±z
      directionsSet: new Set(),

      // info points flags
      riskPointClicked: false,
      waterPointClicked: false,

      // roads used
      roadsExplored: false,

      // quiz
      quizCompleted: false,

      // katmanlar en az bir kez kullanƒ±ldƒ±
      layersUsed: new Set(['topography'])
    };

    // Missions Data (yapƒ± korundu ama check'ler katman mantƒ±ƒüƒ±na g√∂re iyile≈ütirildi)
    const missions = [
      {
        id: 1,
        title: 'Katmanlarƒ± Ke≈üfet',
        desc: 'Su, ula≈üƒ±m, yerle≈üim ve risk katmanlarƒ±nƒ± en az bir kez a√ß',
        reward: 50,
        status: 'active',
        check: () => ['water','roads','settlement','risk'].every(k => gameState.layersUsed.has(k))
      },
      {
        id: 2,
        title: 'Y√∂n Bul',
        desc: 'En az 4 farklƒ± y√∂ne ilerle ve ke≈üfet',
        reward: 75,
        status: 'locked',
        check: () => gameState.directionsSet.size >= 4
      },
      {
        id: 3,
        title: 'Risk Analizi',
        desc: 'Risk katmanƒ±nƒ± a√ß ve risk bilgi noktasƒ±nƒ± ke≈üfet',
        reward: 100,
        status: 'locked',
        check: () => gameState.activeLayers.includes('risk') && gameState.riskPointClicked
      },
      {
        id: 4,
        title: 'Su Kaynaklarƒ±',
        desc: 'Su katmanƒ±nƒ± a√ß ve su bilgi noktasƒ±nƒ± ke≈üfet',
        reward: 100,
        status: 'locked',
        check: () => gameState.activeLayers.includes('water') && gameState.waterPointClicked
      },
      {
        id: 5,
        title: 'G√ºzergah Planlama',
        desc: 'Ula≈üƒ±m katmanƒ±nƒ± a√ß ve haritada biraz gezin',
        reward: 150,
        status: 'locked',
        check: () => gameState.activeLayers.includes('roads') && gameState.roadsExplored
      },
      {
        id: 6,
        title: 'Yerle≈üim Analizi',
        desc: 'Yerle≈üim katmanƒ±nƒ± a√ß ve ≈üehirleri incele',
        reward: 150,
        status: 'locked',
        check: () => gameState.activeLayers.includes('settlement')
      },
      {
        id: 7,
        title: 'Harita Uzmanƒ±',
        desc: 'Harita okuryazarlƒ±ƒüƒ± testini tamamla',
        reward: 200,
        status: 'locked',
        check: () => gameState.quizCompleted
      },
      {
        id: 8,
        title: 'AR Ustasƒ±',
        desc: 'T√ºm g√∂revleri tamamla ve 1000 puana ula≈ü',
        reward: 300,
        status: 'locked',
        check: () => gameState.completedMissions >= 7 && gameState.score >= 1000
      }
    ];

    const achievements = [
      { id: 1, icon: 'üó∫Ô∏è', name: 'ƒ∞lk Ke≈üif', desc: 'ƒ∞lk ek katmanƒ± a√ßtƒ±n', unlocked: false },
      { id: 2, icon: 'üß≠', name: 'Y√∂n Bulma', desc: '4 farklƒ± y√∂ne ilerledin', unlocked: false },
      { id: 3, icon: '‚ö†Ô∏è', name: 'Risk Farkƒ±ndalƒ±ƒüƒ±', desc: 'Risk noktasƒ±nƒ± ke≈üfettin', unlocked: false },
      { id: 4, icon: 'üíß', name: 'Su Ka≈üifi', desc: 'Su noktasƒ±nƒ± ke≈üfettin', unlocked: false },
      { id: 5, icon: 'üèÜ', name: 'ƒ∞lk G√∂rev', desc: 'ƒ∞lk g√∂revi tamamladƒ±n', unlocked: false },
      { id: 6, icon: 'üìö', name: 'Bilgi Avcƒ±sƒ±', desc: '500 puana ula≈ütƒ±n', unlocked: false },
      { id: 7, icon: 'üéì', name: 'Harita Uzmanƒ±', desc: 'Testi ge√ßtin', unlocked: false },
      { id: 8, icon: 'üëë', name: 'AR Ustasƒ±', desc: 'T√ºm g√∂revleri tamamladƒ±n', unlocked: false }
    ];

    const quizQuestions = [
      { question:'Haritada y√ºksekliƒüi g√∂steren katman hangisidir?', options:['Topografya','Ula≈üƒ±m','Yerle≈üim','Risk B√∂lgeleri'], correct:0 },
      { question:'Sel riski analizi i√ßin hangi katmanlar birlikte kullanƒ±lmalƒ±dƒ±r?', options:['Sadece risk','Su kaynaklarƒ± ve topografya','Sadece yerle≈üim','Sadece ula≈üƒ±m'], correct:1 },
      { question:'Bir b√∂lgenin n√ºfus yoƒüunluƒüunu anlamak i√ßin hangi katman kullanƒ±lƒ±r?', options:['Topografya','Su kaynaklarƒ±','Yerle≈üim','Ula≈üƒ±m'], correct:2 },
      { question:'Yaya i√ßin g√ºvenli g√ºzergah planlarken hangi katmanlar √∂nemlidir?', options:['Ula≈üƒ±m ve risk b√∂lgeleri','Sadece topografya','Sadece su','Sadece yerle≈üim'], correct:0 },
      { question:'AR harita uygulamalarƒ±nƒ±n avantajƒ± nedir?', options:['Daha pahalƒ±dƒ±r','Ger√ßek √ßevre ile harita birle≈üir','Sadece sƒ±nƒ±fta kullanƒ±lƒ±r','Tek katman g√∂sterir'], correct:1 }
    ];

    /***********************
     * UI render
     ***********************/
    function renderMissions(){
      const container = document.getElementById('missions');
      container.innerHTML = missions.map(m => `
        <div class="mission-card ${m.status}" data-mission-id="${m.id}">
          <div class="mission-status ${m.status}">${m.status==='locked'?'üîí':m.status==='active'?'‚ö°':'‚úÖ'}</div>
          <div class="mission-title">${m.title}</div>
          <div class="mission-desc">${m.desc}</div>
          <div class="mission-reward">+${m.reward} Puan</div>
        </div>
      `).join('');
    }

    function renderAchievements(){
      const container = document.getElementById('achievements');
      container.innerHTML = achievements.map(a => `
        <div class="achievement ${a.unlocked?'unlocked':''}" data-ach-id="${a.id}">
          <div class="achievement-icon">${a.icon}</div>
          <div class="achievement-name">${a.name}</div>
          <div class="achievement-desc">${a.desc}</div>
        </div>
      `).join('');
    }

    function renderQuiz(){
      const container = document.getElementById('quiz');
      container.innerHTML = quizQuestions.map((q,i)=>`
        <div class="quiz-question" data-question="${i}">
          <div class="quiz-question-text">${i+1}. ${q.question}</div>
          <div class="quiz-options">
            ${q.options.map((opt,j)=>`
              <div class="quiz-option" data-question="${i}" data-option="${j}">${opt}</div>
            `).join('')}
          </div>
        </div>
      `).join('');
    }

    function updateStats(){
      document.getElementById('score').textContent = gameState.score;
      document.getElementById('level').textContent = gameState.level;
      document.getElementById('missions-completed').textContent = `${gameState.completedMissions}/${missions.length}`;
    }

    function addScore(points){
      gameState.score += points;
      const newLevel = Math.floor(gameState.score / 200) + 1;
      if(newLevel > gameState.level) gameState.level = newLevel;
      updateStats();

      if(gameState.score >= 500 && !achievements[5].unlocked) unlockAchievement(6);
    }

    function unlockAchievement(id){
      const ach = achievements.find(a=>a.id===id);
      if(ach && !ach.unlocked){
        ach.unlocked = true;
        renderAchievements();
        // bonus
        gameState.score += 50;
        updateStats();
      }
    }

    function updateTaskPrompt(title, desc){
      const t = document.querySelector("#current-task .task-prompt-title");
      const d = document.querySelector("#current-task .task-prompt-desc");
      t.textContent = title;
      d.textContent = desc;
    }

    /***********************
     * Missions progression
     ***********************/
    function completeMission(index){
      const m = missions[index];
      if(m.status !== 'completed'){
        m.status = 'completed';
        gameState.completedMissions++;
        addScore(m.reward);

        if(gameState.completedMissions === 1 && !achievements[4].unlocked) unlockAchievement(5);

        if(index < missions.length-1) missions[index+1].status = 'active';
        renderMissions();
        updateStats();
      }
    }

    function checkMissions(){
      missions.forEach((m,i)=>{
        if(m.status==='active' && m.check()){
          completeMission(i);
        }else if(m.status==='locked' && i>0 && missions[i-1].status==='completed'){
          m.status='active';
        }
      });
      renderMissions();
    }

    /***********************
     * Quiz
     ***********************/
    function selectQuizOption(el){
      const qid = el.dataset.question;
      document.querySelectorAll(`.quiz-option[data-question="${qid}"]`).forEach(o=>o.classList.remove('selected'));
      el.classList.add('selected');
    }

    function checkQuizAnswers(){
      let correctCount = 0;
      quizQuestions.forEach((q,i)=>{
        const selected = document.querySelector(`.quiz-option[data-question="${i}"].selected`);
        const all = document.querySelectorAll(`.quiz-option[data-question="${i}"]`);
        if(selected){
          const sel = parseInt(selected.dataset.option,10);
          all.forEach(opt=>{
            const idx = parseInt(opt.dataset.option,10);
            if(idx===q.correct) opt.classList.add('correct');
            else if(opt.classList.contains('selected')) opt.classList.add('wrong');
          });
          if(sel===q.correct) correctCount++;
        }
      });

      const panel = document.getElementById('quiz-result');
      const scoreEl = document.getElementById('quiz-score');
      const msgEl = document.getElementById('quiz-message');

      scoreEl.textContent = `${correctCount}/${quizQuestions.length}`;
      const pct = (correctCount/quizQuestions.length)*100;

      if(pct>=80){
        msgEl.textContent = 'M√ºkemmel! Harita okuryazarlƒ±ƒüƒ±nda ustasƒ±n! üèÜ';
        addScore(200);
        if(!achievements[6].unlocked) unlockAchievement(7);
      }else if(pct>=60){
        msgEl.textContent = 'ƒ∞yi! Geli≈ümeye devam et! üëç';
        addScore(150);
      }else{
        msgEl.textContent = 'Daha fazla pratik yapmalƒ±sƒ±n! üí™';
        addScore(100);
      }

      panel.classList.remove('hidden');
      document.getElementById('check-answers').disabled = true;
      gameState.quizCompleted = true;
      checkMissions();
    }

    /***********************
     * Maps (Normal + VR)
     ***********************/
    const trCenter = [39.0, 35.0];
    const trZoom = 6;

    let mapNormal, mapLeft, mapRight;
    let baseTopoN, roadsN, waterN, settleN, riskN;
    let baseTopoL, roadsL, waterL, settleL, riskL;
    let baseTopoR, roadsR, waterR, settleR, riskR;

    const waterLines = [
      [[41.2,28.8],[41.3,31.2],[41.1,33.2],[41.1,35.2],[41.2,37.2]],
      [[39.9,32.7],[39.4,34.7],[38.9,36.4],[37.9,38.7],[37.0,39.2]],
      [[38.7,26.9],[38.8,28.3],[38.6,29.6],[38.3,30.6]]
    ];
    const lakes = [
      ["Van G√∂l√º",38.6,42.9,40000],
      ["Tuz G√∂l√º",38.8,33.3,35000],
      ["Bey≈üehir",37.7,31.7,22000],
      ["Eƒüirdir",37.9,30.9,18000]
    ];
    const cities = [
      ["ƒ∞stanbul",41.0082,28.9784],["Ankara",39.9334,32.8597],["ƒ∞zmir",38.4237,27.1428],
      ["Bursa",40.195,29.06],["Antalya",36.8969,30.7133],["Adana",37.0,35.3213],
      ["Gaziantep",37.0662,37.3833],["Konya",37.8715,32.4846],["Kayseri",38.7225,35.4875],
      ["Trabzon",41.0015,39.7178],["Diyarbakƒ±r",37.9144,40.2306],["Samsun",41.2867,36.33]
    ];

    function buildWaterLayer(){
      const g = L.layerGroup();
      waterLines.forEach(p=>L.polyline(p,{color:"#1ea7ff",weight:5,opacity:.85}).addTo(g));
      lakes.forEach(([n,lat,lng,r])=>{
        L.circle([lat,lng],{radius:r,color:"#1ea7ff",fillColor:"#1ea7ff",fillOpacity:.25,weight:2})
          .bindTooltip("üíß "+n).addTo(g);
      });
      return g;
    }
    function buildSettlementLayer(){
      const g = L.layerGroup();
      cities.forEach(([n,lat,lng])=>{
        L.circleMarker([lat,lng],{radius:8,color:"#ffcc80",fillColor:"#ff6d00",fillOpacity:.85,weight:2})
          .bindTooltip("üèòÔ∏è "+n).addTo(g);
      });
      return g;
    }
    function buildRiskLayer(){
      const g = L.layerGroup();
      L.polygon([[41.35,28.65],[41.45,29.25],[41.20,29.35],[41.10,28.85]],
        {color:"#ff9800",fillColor:"#ff9800",fillOpacity:.25,weight:2}).bindTooltip("üü† Sel riski (√∂rnek)").addTo(g);
      L.polygon([[40.95,39.25],[41.20,39.95],[40.75,40.35],[40.55,39.70]],
        {color:"#ff1744",fillColor:"#ff1744",fillOpacity:.22,weight:2}).bindTooltip("üî¥ Heyelan riski (√∂rnek)").addTo(g);
      L.polygon([[38.7,26.3],[39.5,28.0],[38.6,29.2],[37.8,27.9]],
        {color:"#b71c1c",fillColor:"#b71c1c",fillOpacity:.18,weight:2}).bindTooltip("üî¥ Y√ºksek risk (√∂rnek)").addTo(g);
      return g;
    }

    // Layer apply (topo always on; others toggle)
    function applyLayersTo(map, roads, water, settle, risk){
      // roads
      if(gameState.activeLayers.includes("roads")){
        if(!map.hasLayer(roads)) roads.addTo(map);
      }else{
        if(map.hasLayer(roads)) map.removeLayer(roads);
      }
      // water
      if(gameState.activeLayers.includes("water")){
        if(!map.hasLayer(water)) water.addTo(map);
      }else{
        if(map.hasLayer(water)) map.removeLayer(water);
      }
      // settlement
      if(gameState.activeLayers.includes("settlement")){
        if(!map.hasLayer(settle)) settle.addTo(map);
      }else{
        if(map.hasLayer(settle)) map.removeLayer(settle);
      }
      // risk
      if(gameState.activeLayers.includes("risk")){
        if(!map.hasLayer(risk)) risk.addTo(map);
      }else{
        if(map.hasLayer(risk)) map.removeLayer(risk);
      }
    }

    function initMaps(){
      // NORMAL
      mapNormal = L.map("mapNormal",{zoomControl:true,preferCanvas:true}).setView(trCenter,trZoom);

      // topo always on
      baseTopoN = L.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{
        maxZoom:17,
        attribution:"¬© OpenTopoMap, ¬© OpenStreetMap contributors",
        opacity:1
      }).addTo(mapNormal);

      // overlays
      roadsN = L.tileLayer("https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",{
        maxZoom:19,opacity:.85,attribution:"¬© OpenStreetMap contributors"
      });
      waterN  = buildWaterLayer();
      settleN = buildSettlementLayer();
      riskN   = buildRiskLayer();

      // default: only topo visible
      applyLayersTo(mapNormal, roadsN, waterN, settleN, riskN);

      // help: initial task
      updateTaskPrompt("Topografya hazƒ±r ‚úÖ", "≈ûimdi Su / Ula≈üƒ±m / Yerle≈üim / Risk katmanlarƒ±nƒ± a√ßƒ±p kapatmayƒ± dene. Katmanlar √ºst √ºste bindirilir.");
    }

    /***********************
     * Layer toggle - SENƒ∞N istediƒüin davranƒ±≈ü
     ***********************/
    function setLayerButtonUI(layerName, isOn){
      document.querySelectorAll(`.layer-btn[data-layer="${layerName}"]`).forEach(btn=>{
        // topo hep a√ßƒ±k
        if(layerName==="topography") return;
        btn.classList.toggle("inactive", !isOn);
      });
    }

    function toggleLayer(layerName){
      if(layerName==="topography"){
        // hep a√ßƒ±k: sadece bilgilendirme
        addScore(1);
        updateTaskPrompt("Topografya hep a√ßƒ±k üèîÔ∏è", "Topografya kapatƒ±lmaz. Diƒüer katmanlarƒ± a√ßƒ±p kapatabilirsin.");
        return;
      }

      const idx = gameState.activeLayers.indexOf(layerName);
      const willTurnOn = idx === -1;

      if(willTurnOn){
        gameState.activeLayers.push(layerName);
        gameState.layersUsed.add(layerName);
        if(gameState.layersUsed.size >= 2 && !achievements[0].unlocked) unlockAchievement(1);
        addScore(10);
      }else{
        gameState.activeLayers.splice(idx,1);
        addScore(3);
      }

      // UI
      setLayerButtonUI(layerName, willTurnOn);

      // maps
      applyLayersTo(mapNormal, roadsN, waterN, settleN, riskN);
      if(mapLeft && mapRight){
        applyLayersTo(mapLeft, roadsL, waterL, settleL, riskL);
        applyLayersTo(mapRight, roadsR, waterR, settleR, riskR);
      }

      // mission checks
      if(layerName==="roads") gameState.roadsExplored = true;

      updateTaskPrompt("Katman g√ºncellendi ‚úÖ",
        `A√ßƒ±k katmanlar: ${gameState.activeLayers.map(x=>({
          topography:"Topografya",water:"Su",roads:"Ula≈üƒ±m",settlement:"Yerle≈üim",risk:"Risk"
        }[x]||x)).join(", ")}`);

      checkMissions();
    }

    /***********************
     * Direction buttons -> haritada pan
     ***********************/
    function panByDirection(dir){
      const step = 0.7; // degrees-ish via latlng
      const c = mapNormal.getCenter();
      const delta = {
        n:[ step, 0], s:[-step,0], e:[0, step], w:[0,-step],
        ne:[ step, step], nw:[ step,-step], se:[-step, step], sw:[-step,-step]
      }[dir] || [0,0];

      const next = L.latLng(c.lat + delta[0], c.lng + delta[1]);
      mapNormal.panTo(next,{animate:true,duration:0.25});

      // stats for missions
      gameState.currentDirection = dir;
      gameState.directionsSet.add(dir);

      if(gameState.directionsSet.size >= 4 && !achievements[1].unlocked) unlockAchievement(2);

      addScore(2);
      checkMissions();
    }

    /***********************
     * Info Points -> Puan + g√∂rev tetik
     ***********************/
    function clickInfoPoint(type){
      if(type==="risk"){
        gameState.riskPointClicked = true;
        if(!achievements[2].unlocked) unlockAchievement(3);
        updateTaskPrompt("Risk Noktasƒ± ‚ö†Ô∏è", "Risk okumasƒ±nda eƒüim + su + yerle≈üim birlikte deƒüerlendirilir.");
      }else if(type==="water"){
        gameState.waterPointClicked = true;
        if(!achievements[3].unlocked) unlockAchievement(4);
        updateTaskPrompt("Su Noktasƒ± üíß", "Su katmanƒ±nƒ± a√ßƒ±k tutup g√∂l/nehirleri inceleyebilirsin.");
      }else{
        updateTaskPrompt("Topografya üìä", "Y√ºkselti (topografya) araziyi anlamanƒ±n temel katmanƒ±dƒ±r.");
      }
      addScore(25);
      checkMissions();
    }

    /***********************
     * VR Mode (iki g√∂z + HUD sabit)
     ***********************/
    let vrOn = false;
    let selectedIndex = 0;
    const selectable = ["water","roads","settlement","risk"]; // topo sabit
    let motionEnabled = false;
    let lastMotionTs = 0;

    function isLandscape(){
      return window.matchMedia("(orientation: landscape)").matches;
    }
    function updateRotateHint(){
      document.getElementById("rotateHint").classList.toggle("on", vrOn && !isLandscape());
    }

    function syncMaps(a,b){
      let lock=false;
      a.on("move", ()=>{
        if(lock) return;
        lock=true;
        b.setView(a.getCenter(), a.getZoom(), {animate:false});
        lock=false;
      });
    }

    function enterVR(){
      vrOn = true;
      document.getElementById("vrOverlay").classList.add("on");
      document.body.classList.add("vr-lock");
      document.getElementById("vr-toggle").classList.add("active");
      document.getElementById("vr-toggle").textContent = "‚úñ VR Kapat";
      updateRotateHint();

      if(!mapLeft){
        mapLeft = L.map("mapLeft",{zoomControl:false,attributionControl:false,preferCanvas:true})
          .setView(mapNormal.getCenter(), mapNormal.getZoom());
        mapRight = L.map("mapRight",{zoomControl:false,attributionControl:false,preferCanvas:true})
          .setView(mapNormal.getCenter(), mapNormal.getZoom());

        baseTopoL = L.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{maxZoom:17,opacity:1}).addTo(mapLeft);
        baseTopoR = L.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{maxZoom:17,opacity:1}).addTo(mapRight);

        roadsL = L.tileLayer("https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",{maxZoom:19,opacity:.85});
        roadsR = L.tileLayer("https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",{maxZoom:19,opacity:.85});

        waterL = buildWaterLayer(); waterR = buildWaterLayer();
        settleL = buildSettlementLayer(); settleR = buildSettlementLayer();
        riskL = buildRiskLayer(); riskR = buildRiskLayer();

        applyLayersTo(mapLeft, roadsL, waterL, settleL, riskL);
        applyLayersTo(mapRight, roadsR, waterR, settleR, riskR);

        syncMaps(mapLeft,mapRight);
        syncMaps(mapRight,mapLeft);
      }

      setTimeout(()=>{
        mapLeft.invalidateSize(); mapRight.invalidateSize();
        mapLeft.setView(mapNormal.getCenter(), mapNormal.getZoom(), {animate:false});
        mapRight.setView(mapNormal.getCenter(), mapNormal.getZoom(), {animate:false});
      },80);

      // HUD buttons (iOS tap fix)
      document.querySelectorAll("#vrHud .layer-btn[data-layer]").forEach(btn=>{
        if(btn.dataset.bound) return;
        btn.dataset.bound = "1";
        bindTap(btn, ()=>toggleLayer(btn.dataset.layer));
      });

      bindTap(document.getElementById("vrCloseBtn"), exitVR);
      bindTap(document.getElementById("zoomIn"), ()=>{ mapLeft.zoomIn(); addScore(1); });
      bindTap(document.getElementById("zoomOut"), ()=>{ mapLeft.zoomOut(); addScore(1); });
      bindTap(document.getElementById("centerTR"), ()=>{
        mapLeft.setView(trCenter,trZoom,{animate:true});
        addScore(2);
      });

      bindTap(document.getElementById("motionBtn"), requestMotionPermission);

      refreshVRHudButtons();
      addScore(10);
    }

    function exitVR(){
      vrOn = false;
      document.getElementById("vrOverlay").classList.remove("on");
      document.body.classList.remove("vr-lock");
      document.getElementById("vr-toggle").classList.remove("active");
      document.getElementById("vr-toggle").textContent = "ü•Ω VR Modu";
      motionEnabled = false;
      document.getElementById("motionBtn").textContent = "üéõ Ba≈ü ƒ∞zleme ƒ∞zni";
      updateRotateHint();
      addScore(5);
    }

    function refreshVRHudButtons(){
      // normal buton state'ini VR HUD'a yansƒ±t
      ["roads","water","settlement","risk"].forEach(k=>{
        const on = gameState.activeLayers.includes(k);
        document.querySelectorAll(`#vrHud .layer-btn[data-layer="${k}"]`).forEach(btn=>{
          btn.classList.toggle("inactive", !on);
        });
      });

      // se√ßili katmanƒ± outline ile g√∂ster (kumanda i√ßin)
      selectable.forEach((k,i)=>{
        const btn = document.querySelector(`#vrHud .layer-btn[data-layer="${k}"]`);
        if(btn) btn.style.outline = (i===selectedIndex) ? "3px solid rgba(255,255,255,.85)" : "none";
      });
    }

    // motion
    async function requestMotionPermission(){
      try{
        if(typeof DeviceOrientationEvent !== "undefined" && typeof DeviceOrientationEvent.requestPermission === "function"){
          const res = await DeviceOrientationEvent.requestPermission();
          if(res !== "granted") throw new Error("ƒ∞zin verilmedi");
        }
        motionEnabled = true;
        document.getElementById("motionBtn").textContent = "‚úÖ Ba≈ü ƒ∞zleme A√ßƒ±k";
        addScore(3);
      }catch(e){
        alert("Ba≈ü izleme izni alƒ±namadƒ±.\nAyarlar > Safari > Hareket & Y√∂n eri≈üimini kontrol et.\n\nDetay: " + e.message);
      }
    }

    function headingToDir(deg){
      const dirs = ["N","NE","E","SE","S","SW","W","NW"];
      const idx = Math.round(((deg%360)+360)%360 / 45) % 8;
      return dirs[idx];
    }

    window.addEventListener("deviceorientation",(e)=>{
      if(!vrOn || !motionEnabled || !mapLeft) return;
      const now = performance.now();
      if(now - lastMotionTs < 40) return;
      lastMotionTs = now;

      const alpha = (e.alpha ?? 0); // yaw
      const beta = (e.beta ?? 0);   // pitch

      const heading = ((alpha % 360) + 360) % 360;
      document.getElementById("compassDeg").textContent = Math.round(heading) + "¬∞";
      document.getElementById("compassDir").textContent = headingToDir(heading);

      // pan effect
      const yaw = ((heading + 540) % 360) - 180; // -180..180
      const pitch = Math.max(-35, Math.min(35, beta));

      const z = mapLeft.getZoom();
      const scale = 0.0009 * Math.pow(2, (7 - z));
      const dx = yaw * scale;
      const dy = pitch * scale;

      const c = mapLeft.getCenter();
      const next = L.latLng(c.lat + (-dy), c.lng + (dx));
      mapLeft.panTo(next,{animate:false});
    },{passive:true});

    // Keyboard / Kumanda (ok + enter/space + esc)
    document.addEventListener("keydown",(e)=>{
      if(!vrOn) return;

      if(["ArrowLeft","ArrowUp"].includes(e.key)){
        e.preventDefault();
        selectedIndex = (selectedIndex - 1 + selectable.length) % selectable.length;
        refreshVRHudButtons();
      }else if(["ArrowRight","ArrowDown"].includes(e.key)){
        e.preventDefault();
        selectedIndex = (selectedIndex + 1) % selectable.length;
        refreshVRHudButtons();
      }else if(e.key === "Enter" || e.key === " "){
        e.preventDefault();
        const key = selectable[selectedIndex];
        toggleLayer(key);
        refreshVRHudButtons();
      }else if(e.key.toLowerCase() === "escape"){
        e.preventDefault();
        exitVR();
      }
    },{passive:false});

    window.addEventListener("resize", ()=>{
      if(vrOn){
        updateRotateHint();
        if(mapLeft){ mapLeft.invalidateSize(); mapRight.invalidateSize(); }
      }
    },{passive:true});
    window.addEventListener("orientationchange", ()=>{
      if(vrOn){
        setTimeout(()=>{
          updateRotateHint();
          if(mapLeft){ mapLeft.invalidateSize(); mapRight.invalidateSize(); }
        },250);
      }
    });

    /***********************
     * Event listeners (korundu ama iOS tap fix ile)
     ***********************/
    function setupEventListeners(){
      // Layer buttons
      document.querySelectorAll('.layer-btn').forEach(btn=>{
        bindTap(btn, ()=> {
          toggleLayer(btn.dataset.layer);
          refreshVRHudButtons();
        });
      });

      // Direction buttons
      document.querySelectorAll('.direction-btn').forEach(btn=>{
        bindTap(btn, ()=> panByDirection(btn.dataset.direction));
      });

      // Info points
      document.querySelectorAll('.ar-info-point').forEach(point=>{
        bindTap(point, ()=> clickInfoPoint(point.dataset.info));
      });

      // Quiz
      document.querySelectorAll('.quiz-option').forEach(opt=>{
        bindTap(opt, ()=> selectQuizOption(opt));
      });
      bindTap(document.getElementById('check-answers'), checkQuizAnswers);

      // BEP
      bindTap(document.getElementById('bep-toggle'), toggleBEPMode);

      // VR Toggle
      bindTap(document.getElementById('vr-toggle'), ()=>{
        if(!vrOn) enterVR(); else exitVR();
      });
    }

    function toggleBEPMode(){
      gameState.bepMode = !gameState.bepMode;
      document.body.classList.toggle('bep-mode');
      const btn = document.getElementById('bep-toggle');
      btn.classList.toggle('active');
      btn.textContent = gameState.bepMode ? 'Normal Mod' : 'BEP Modu';
      addScore(2);
    }

    /***********************
     * Init
     ***********************/
    function init(){
      renderMissions();
      renderAchievements();
      renderQuiz();
      initMaps();
      setupEventListeners();
      updateStats();
      checkMissions();
    }
    init();
  </script>
</body>
</html>
