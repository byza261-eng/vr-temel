<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HaritaGÃ¶z - Normal Scroll + VR Split</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{width:100%;height:100%;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#12202b;color:#fff}
    a,button{ -webkit-tap-highlight-color: transparent; }

    /* NORMAL MOD: scroll aÃ§Ä±k */
    body{ overflow:auto; }

    .header{
      position:sticky; top:0; z-index:10;
      background: rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(76,175,80,.25);
      padding: 14px 14px;
      display:flex; gap:10px; align-items:center; justify-content:space-between;
    }
    .logo{font-size:22px;font-weight:900;color:#4CAF50;display:flex;gap:8px;align-items:center}
    .actions{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:flex-end}
    .pill{
      border:0; border-radius:18px; padding:10px 14px;
      font-weight:900; color:#fff; cursor:pointer; user-select:none;
      touch-action: manipulation;
    }
    .pill.vr{background:#6A1B9A}
    .pill.vr.active{background:#D32F2F}
    .pill.bep{background:#2196F3}
    .pill.bep.active{background:#FF9800}

    .wrap{max-width:1100px;margin:0 auto;padding:14px}
    .card{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      border-radius:18px;
      padding:14px;
      margin-bottom:14px;
    }
    .title{font-size:18px;font-weight:900;color:#4CAF50;margin-bottom:10px;display:flex;gap:8px;align-items:center}

    /* Sim */
    .viewport{
      width:100%;
      height:360px;
      border-radius:14px;
      background: linear-gradient(to bottom,#87CEEB 0%,#90EE90 55%,#8B4513 100%);
      position:relative;
      overflow:hidden;
      border: 3px solid rgba(76,175,80,.7);
    }
    .layers{position:absolute;inset:0;pointer-events:none}
    .layer{position:absolute;inset:0;transition:opacity .2s}
    .hidden{opacity:0}

    .topography-layer{
      background: repeating-linear-gradient(
        45deg, transparent, transparent 10px,
        rgba(139,69,19,.22) 10px, rgba(139,69,19,.22) 20px
      );
    }
    .roads-layer{
      background:
        repeating-linear-gradient(90deg, transparent, transparent 50px, rgba(255,255,0,.65) 50px, rgba(255,255,0,.65) 52px),
        repeating-linear-gradient(0deg, transparent, transparent 80px, rgba(255,255,0,.65) 80px, rgba(255,255,0,.65) 82px);
    }
    .water-layer{
      background:
        radial-gradient(circle at 30% 70%, rgba(30,144,255,.6) 0%, transparent 30%),
        radial-gradient(circle at 70% 40%, rgba(30,144,255,.5) 0%, transparent 25%);
    }
    .settlement-layer{
      background:
        radial-gradient(circle at 50% 30%, rgba(255,165,0,.42) 0%, transparent 20%),
        radial-gradient(circle at 20% 60%, rgba(255,165,0,.32) 0%, transparent 15%),
        radial-gradient(circle at 80% 70%, rgba(255,165,0,.32) 0%, transparent 15%);
    }
    .risk-layer{
      background:
        radial-gradient(circle at 60% 80%, rgba(255,0,0,.55) 0%, transparent 25%),
        radial-gradient(circle at 25% 30%, rgba(255,0,0,.42) 0%, transparent 20%);
    }

    .info{
      position:absolute;
      padding:8px 10px;
      border-radius:12px;
      background: rgba(76,175,80,.92);
      font-weight:900;
      font-size:13px;
      cursor:pointer; user-select:none;
      touch-action: manipulation;
      box-shadow: 0 6px 16px rgba(0,0,0,.35);
    }

    .controls{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
    .btn{
      border:0;border-radius:12px;padding:10px 12px;
      font-weight:900;cursor:pointer;user-select:none;
      touch-action: manipulation;
      display:flex;gap:8px;align-items:center;
    }
    .btn.topo{background: linear-gradient(135deg,#8B4513,#D2691E); color:#fff;}
    .btn.roads{background: linear-gradient(135deg,#FFD700,#FFA500); color:#1c1c1c;}
    .btn.water{background: linear-gradient(135deg,#1E90FF,#4169E1); color:#fff;}
    .btn.settle{background: linear-gradient(135deg,#FF6347,#FF8C00); color:#fff;}
    .btn.risk{background: linear-gradient(135deg,#DC143C,#8B0000); color:#fff;}
    .inactive{opacity:.40;filter:grayscale(1)}

    .dir{
      margin-top:12px;
      display:grid;
      grid-template-columns:repeat(3,56px);
      gap:8px;
      justify-content:center;
    }
    .dir button{
      width:56px;height:44px;border:0;border-radius:12px;
      background:#2196F3;color:#fff;font-size:18px;font-weight:900;
      cursor:pointer;user-select:none;touch-action: manipulation;
    }

    /* BEP */
    body.bep-mode{ font-size: 18px; }
    body.bep-mode .btn, body.bep-mode .pill, body.bep-mode .dir button { font-size: 18px; }

    /* ================= VR OVERLAY ================= */
    body.vr-on{ overflow:hidden; } /* VR modda scroll kilit */

    #vrOverlay{
      position:fixed; inset:0;
      background:#000;
      z-index:9999;
      display:none;
    }
    body.vr-on #vrOverlay{ display:block; }

    /* EÄŸer telefon portrait ise VR iÃ§eriÄŸi 90Â° Ã§evirip landscape gibi kullan */
    .vrStage{
      position:absolute; inset:0;
      transform-origin: center center;
    }

    /* portrait -> rotate */
    .portrait .vrStage{
      width:100vh;
      height:100vw;
      left:50%; top:50%;
      transform: translate(-50%,-50%) rotate(90deg);
    }
    /* landscape -> normal */
    .landscape .vrStage{
      width:100vw; height:100vh;
      left:0; top:0;
      transform: none;
    }

    /* VR HUD (kontrol ÅŸeridi) */
    .vrHud{
      position:absolute;
      left:0; right:0;
      top:0;
      display:flex; gap:8px;
      padding:10px;
      justify-content:center;
      align-items:center;
      z-index:2;
      background: linear-gradient(to bottom, rgba(0,0,0,.75), rgba(0,0,0,0));
      pointer-events:auto;
    }
    .vrHud button{
      border:0; border-radius:12px;
      padding:10px 12px;
      font-weight:900;
      cursor:pointer;
      color:#fff;
      background: rgba(255,255,255,.12);
      touch-action: manipulation;
      user-select:none;
      backdrop-filter: blur(8px);
    }
    .vrHud button.danger{ background: rgba(211,47,47,.92); }

    /* Split eyes */
    .eyes{
      position:absolute; inset:0;
      display:flex;
      gap:0;
      align-items:stretch;
      justify-content:stretch;
      z-index:1;
    }
    .eye{
      width:50%;
      height:100%;
      overflow:hidden;
      position:relative;
      border-left: 1px solid rgba(255,255,255,.06);
      border-right: 1px solid rgba(255,255,255,.06);
    }

    /* VR viewportâ€™u gÃ¶zlere tam sÄ±ÄŸdÄ±r */
    .vrView{
      position:absolute;
      left:50%; top:50%;
      transform: translate(-50%,-50%);
      width: min(100%, 100vh);         /* gÃ¶z iÃ§inde kareye yakÄ±n tutar */
      height: min(100%, 100vw);
      max-width: 100%;
      max-height: 100%;
      aspect-ratio: 16/9;              /* daha rahat gÃ¶rÃ¼nÃ¼m */
      border-radius: 14px;
      overflow:hidden;
      border: 2px solid rgba(76,175,80,.55);
      background: #111;
    }

    /* VR view iÃ§inde bizim normal viewportâ€™u Ã¶lÃ§ekleyip koyacaÄŸÄ±z */
    .vrInner{
      width:100%;
      height:100%;
      position:relative;
    }

    /* VR modda tÄ±klanma: Ã¼st HUD dÃ¼ÄŸmeleri + istersen info noktalarÄ± aktif */
    .vrInner .info{ font-size:12px; padding:7px 9px; }

    /* kÃ¼Ã§Ã¼k ekranlarda HUD Ã§ok bÃ¼yÃ¼mesin */
    @media (max-width: 420px){
      .vrHud button{ padding:9px 10px; font-size:13px; }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">ğŸ—ºï¸ HaritaGÃ¶z</div>
    <div class="actions">
      <button class="pill bep" id="bepBtn" type="button">BEP Modu</button>
      <button class="pill vr" id="vrBtn" type="button">VR Modu</button>
    </div>
  </div>

  <div class="wrap">
    <div class="card">
      <div class="title">ğŸ¯ AR Harita SimÃ¼latÃ¶rÃ¼</div>

      <div class="viewport" id="viewport">
        <div class="layers">
          <div class="layer topography-layer" id="layer-topography"></div>
          <div class="layer roads-layer hidden" id="layer-roads"></div>
          <div class="layer water-layer hidden" id="layer-water"></div>
          <div class="layer settlement-layer hidden" id="layer-settlement"></div>
          <div class="layer risk-layer hidden" id="layer-risk"></div>
        </div>

        <div class="info" style="top:26%; left:26%" data-info="topography">ğŸ“Š Topografya</div>
        <div class="info" style="top:70%; left:58%" data-info="risk">âš ï¸ Risk</div>
        <div class="info" style="top:40%; left:70%" data-info="water">ğŸ’§ Su</div>
      </div>

      <div class="controls">
        <button class="btn topo" data-layer="topography" type="button">ğŸ”ï¸ Topografya</button>
        <button class="btn roads inactive" data-layer="roads" type="button">ğŸ›£ï¸ UlaÅŸÄ±m</button>
        <button class="btn water inactive" data-layer="water" type="button">ğŸ’§ Su</button>
        <button class="btn settle inactive" data-layer="settlement" type="button">ğŸ˜ï¸ YerleÅŸim</button>
        <button class="btn risk inactive" data-layer="risk" type="button">âš ï¸ Risk</button>
      </div>

      <div class="dir">
        <button data-dir="nw" type="button">â†–ï¸</button>
        <button data-dir="n"  type="button">â¬†ï¸</button>
        <button data-dir="ne" type="button">â†—ï¸</button>
        <button data-dir="w"  type="button">â¬…ï¸</button>
        <button data-dir="e"  type="button">â¡ï¸</button>
        <button data-dir="sw" type="button">â†™ï¸</button>
        <button data-dir="s"  type="button">â¬‡ï¸</button>
        <button data-dir="se" type="button">â†˜ï¸</button>
      </div>

      <div style="margin-top:10px;color:#B0BEC5;font-size:13px;line-height:1.4">
        Normal modda sayfa kayar âœ…<br>
        VR modda ekran yatay â€œiki gÃ¶zâ€ olur âœ… (telefon dik olsa bile otomatik dÃ¶ndÃ¼rÃ¼r)
      </div>
    </div>

    <!-- Ã–rnek ekstra iÃ§erik: scroll test iÃ§in -->
    <div class="card">
      <div class="title">ğŸ“Œ Notlar</div>
      <div style="color:#CFD8DC;line-height:1.55">
        Buraya proje metni, yÃ¶nergeler, gÃ¶rev aÃ§Ä±klamalarÄ± vs. ekleyebilirsin. Normal modda aÅŸaÄŸÄ±ya kayarak okunur.
      </div>
    </div>
  </div>

  <!-- VR Overlay -->
  <div id="vrOverlay" aria-hidden="true">
    <div id="vrRoot" class="landscape">
      <div class="vrStage">
        <div class="vrHud">
          <button id="vrClose" class="danger" type="button">âœ• Kapat</button>
          <button id="vrLayerTop" type="button">ğŸ”ï¸</button>
          <button id="vrLayerRoads" type="button">ğŸ›£ï¸</button>
          <button id="vrLayerWater" type="button">ğŸ’§</button>
          <button id="vrLayerSet" type="button">ğŸ˜ï¸</button>
          <button id="vrLayerRisk" type="button">âš ï¸</button>
          <button id="vrDir" type="button">ğŸ§­ YÃ¶n</button>
        </div>

        <div class="eyes">
          <div class="eye">
            <div class="vrView">
              <div class="vrInner" id="vrLeft"></div>
            </div>
          </div>
          <div class="eye">
            <div class="vrView">
              <div class="vrInner" id="vrRight"></div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

<script>
  /* iOS iÃ§in saÄŸlam dokunma */
  function bindTap(el, fn){
    if(!el) return;
    const fire = (e)=>{ try{ e.preventDefault?.(); }catch(_){} fn(e); };
    el.addEventListener('touchend', fire, {passive:false});
    el.addEventListener('pointerup', fire, {passive:false});
    el.addEventListener('click', (e)=>{ e.preventDefault(); fn(e); }, false);
  }

  const state = {
    bep:false,
    vr:false,
    activeLayers: new Set(['topography']),
    dirIndex:0,
    dirs:['N','NE','E','SE','S','SW','W','NW']
  };

  function setPortraitLandscapeClass(){
    const vrRoot = document.getElementById('vrRoot');
    const isPortrait = window.innerHeight > window.innerWidth;
    vrRoot.className = isPortrait ? 'portrait' : 'landscape';
  }

  function layerEl(name){ return document.getElementById('layer-'+name); }
  function btnEl(name){ return document.querySelector(`.btn[data-layer="${name}"]`); }

  function toggleLayer(name){
    const layer = layerEl(name);
    const btn = btnEl(name);
    if(!layer || !btn) return;

    const willShow = layer.classList.contains('hidden');
    if(willShow){
      layer.classList.remove('hidden');
      btn.classList.remove('inactive');
      state.activeLayers.add(name);
    }else{
      // topography kapatÄ±labilir mi? istersen kilitleyebiliriz. Åimdilik serbest.
      layer.classList.add('hidden');
      btn.classList.add('inactive');
      state.activeLayers.delete(name);
    }
    if(state.vr) renderVR(); // VR aÃ§Ä±kken anlÄ±k gÃ¼ncelle
  }

  function flashViewport(){
    const vp = document.getElementById('viewport');
    vp.style.filter='brightness(1.2)';
    setTimeout(()=>vp.style.filter='brightness(1)',150);
  }

  function rotateDir(){
    state.dirIndex = (state.dirIndex+1) % state.dirs.length;
    flashViewport();
    if(state.vr) renderVR();
  }

  function clickInfo(type){
    // istersen burada puan/gÃ¶rev ekleriz, ÅŸu an sadece gÃ¶rsel geri bildirim:
    flashViewport();
    if(state.vr) renderVR();
  }

  function toggleBEP(){
    state.bep = !state.bep;
    document.body.classList.toggle('bep-mode');
    const b = document.getElementById('bepBtn');
    b.classList.toggle('active');
    b.textContent = state.bep ? 'Normal Mod' : 'BEP Modu';
  }

  function openVR(){
    if(state.vr) return;
    state.vr = true;

    document.body.classList.add('vr-on');
    document.getElementById('vrOverlay').setAttribute('aria-hidden','false');

    const vrBtn = document.getElementById('vrBtn');
    vrBtn.classList.add('active');
    vrBtn.textContent = 'VR Kapat';

    setPortraitLandscapeClass();
    renderVR();
  }

  function closeVR(){
    if(!state.vr) return;
    state.vr = false;

    document.body.classList.remove('vr-on');
    document.getElementById('vrOverlay').setAttribute('aria-hidden','true');

    document.getElementById('vrLeft').innerHTML = '';
    document.getElementById('vrRight').innerHTML = '';

    const vrBtn = document.getElementById('vrBtn');
    vrBtn.classList.remove('active');
    vrBtn.textContent = 'VR Modu';
  }

  function toggleVR(){
    state.vr ? closeVR() : openVR();
  }

  /* VR iÃ§inde sadece viewportâ€™u iki gÃ¶zde gÃ¶steriyoruz (tam sÄ±ÄŸacak ÅŸekilde) */
  function buildViewportHTML(){
    // aktif katmanlara gÃ¶re hidden sÄ±nÄ±flarÄ±nÄ± kopyalÄ±yoruz:
    const active = state.activeLayers;

    const cls = (name)=> active.has(name) ? '' : 'hidden';

    return `
      <div class="viewport" style="height:100%; border:0; border-radius:0;">
        <div class="layers">
          <div class="layer topography-layer ${cls('topography')}" id="v-topography"></div>
          <div class="layer roads-layer ${cls('roads')}" id="v-roads"></div>
          <div class="layer water-layer ${cls('water')}" id="v-water"></div>
          <div class="layer settlement-layer ${cls('settlement')}" id="v-settlement"></div>
          <div class="layer risk-layer ${cls('risk')}" id="v-risk"></div>
        </div>

        <div class="info" style="top:26%; left:26%">ğŸ“Š</div>
        <div class="info" style="top:70%; left:58%">âš ï¸</div>
        <div class="info" style="top:40%; left:70%">ğŸ’§</div>

        <div style="
          position:absolute; left:10px; bottom:10px;
          padding:6px 10px; border-radius:12px;
          background:rgba(0,0,0,.45); font-weight:900; font-size:12px;
          border:1px solid rgba(255,255,255,.10);
        ">
          ğŸ§­ ${state.dirs[state.dirIndex]}
        </div>
      </div>
    `;
  }

  function renderVR(){
    const html = buildViewportHTML();
    document.getElementById('vrLeft').innerHTML = html;
    document.getElementById('vrRight').innerHTML = html;

    // VR iÃ§indeki info noktalarÄ±na tÄ±klanma (ikonlar)
    document.querySelectorAll('#vrOverlay .vrInner .info').forEach((el, idx)=>{
      bindTap(el, ()=> {
        if(idx===1) clickInfo('risk');
        else if(idx===2) clickInfo('water');
        else clickInfo('topography');
      });
    });
  }

  /* NORMAL butonlar */
  document.querySelectorAll('.btn[data-layer]').forEach(b=> bindTap(b, ()=>toggleLayer(b.dataset.layer)));
  document.querySelectorAll('.dir button').forEach(b=> bindTap(b, ()=>rotateDir()));

  document.querySelectorAll('.info').forEach(p=> bindTap(p, ()=>clickInfo(p.dataset.info)));

  bindTap(document.getElementById('bepBtn'), toggleBEP);
  bindTap(document.getElementById('vrBtn'), toggleVR);

  /* VR HUD butonlarÄ± */
  bindTap(document.getElementById('vrClose'), closeVR);
  bindTap(document.getElementById('vrLayerTop'), ()=>toggleLayer('topography'));
  bindTap(document.getElementById('vrLayerRoads'), ()=>toggleLayer('roads'));
  bindTap(document.getElementById('vrLayerWater'), ()=>toggleLayer('water'));
  bindTap(document.getElementById('vrLayerSet'), ()=>toggleLayer('settlement'));
  bindTap(document.getElementById('vrLayerRisk'), ()=>toggleLayer('risk'));
  bindTap(document.getElementById('vrDir'), rotateDir);

  /* VR modda sayfayÄ± kaydÄ±rmayÄ± engelle */
  document.getElementById('vrOverlay').addEventListener('touchmove', e=>e.preventDefault(), {passive:false});

  window.addEventListener('resize', ()=>{
    if(state.vr){
      setPortraitLandscapeClass();
      renderVR();
    }
  });
  window.addEventListener('orientationchange', ()=>{
    setTimeout(()=>{
      if(state.vr){
        setPortraitLandscapeClass();
        renderVR();
      }
    }, 250);
  });
</script>
</body>
</html>
